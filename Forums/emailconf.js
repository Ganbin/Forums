/** * @param {HTTPRequest} request * @param {HTTPResponse} response */function emailConfirmation(request, response){	var promoteToken;	var namespace = require('namespace'); 	promoteToken = currentSession().promoteWith('Administrateur'); 	var confId = request.urlQuery; 	var found = ds.User.find('validationId = :1', confId); 	 	if (found != null){ 		// response construct 		try{	 		found.statut = 'validated';		    found.save();		    		    var newUserGroup = ds.UserGroup.createEntity();		    		    newUserGroup.user = found;		    newUserGroup.group = ds.Group(namespace.getMemberGroupID());		    newUserGroup.save();		    		    response.body = '<html><body><center><b>Thank you '+found.fullName+' !</b><br>';	 		response.body += 'Your confirmation is OK. You can now use the forum as a member</center></body></html>';		    response.contentType = 'text/html';		    response.statusCode = '200'; 		}catch(e){ 			response.body = '<html><body><b>Sorry but we cannot process your request !</b><br>';	 		response.body += '</body></html>';		    response.contentType = 'text/html';		    response.statusCode = '404'; 		} 	}else{ 		response.body = '<html><body><b>Sorry but we cannot process your request !</b><br>'; 		response.body += '</body></html>';	    response.contentType = 'text/html';	    response.statusCode = '404'; 	} 	currentSession().unPromote(promoteToken); }