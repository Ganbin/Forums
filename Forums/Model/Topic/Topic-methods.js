/******This method allow the user who have the write acces on a forum to create a new topictitle : title of the topicforumID : forum of the id where we want to create the topicmessageContent : the content of the message of the topic******/model.Topic.methods.createTopic = function(title,forumID,messageContent) {		var curSess = currentSession();		if(curSess.user.fullName === 'default guest'){		return {error:62,errorMessage:"You must be logged!"};	}		var forum = ds.Forum.find('ID = :1',forumID);	var promoteToken;				if(!curSess.belongsTo('Administrateur')){ // If we are not the dataAdmin				try{			promoteToken = curSess.promoteWith('CUD_Topic_Post');						var userAccesses = forum.getUserAccess(curSess.storage.userID);						if(userAccesses !== false){ // If the user have some access for this forum				if(userAccesses.actions.write === true){										var newTopic = ds.Topic.createEntity();								newTopic.title = title;					newTopic.stamp = new Date();					newTopic.forum = ds.Forum(forumID);					newTopic.user = ds.User(curSess.storage.userID);										try{						newTopic.save();					}catch(e){						curSess.unPromote(promoteToken);						return {error:e.sourceId,errorMessage:e.message};					}										var newPost = ds.Post.createEntity();										newPost.title = title;					newPost.content = messageContent;					newPost.stamp = new Date();					newPost.topic = newTopic;					newPost.user = ds.User(curSess.storage.userID);										try{						newPost.save();					}catch(e){						curSess.unPromote(promoteToken);						return {error:e.sourceId,errorMessage:e.message};					}				}else{					curSess.unPromote(promoteToken);					return {error:63,errorMessage:"You don't have write access for this forum."};				}					}else{				curSess.unPromote(promoteToken);				return {error:64,errorMessage:"You don't have any access for this forum."};			}						curSess.unPromote(promoteToken);		}catch(e){					}			}else{ // If we are the data Admin			var newTopic = ds.Topic.createEntity();				newTopic.title = title;		newTopic.stamp = new Date();		newTopic.forum = ds.Forum(forumID);		newTopic.user = ds.User(curSess.storage.userID);				try{			newTopic.save();		}catch(e){			return {error:e.sourceId,errorMessage:e.message};		}				var newPost = ds.Post.createEntity();				newPost.title = title;		newPost.content = messageContent;		newPost.stamp = new Date();		newPost.topic = newTopic;		newPost.user = ds.User(curSess.storage.userID);				try{			newPost.save();		}catch(e){			return {error:e.sourceId,errorMessage:e.message};		}	}		return newTopic;};model.Topic.methods.createTopic.scope = 'public';model.Topic.entityMethods.edit = function(title) {	var curSess = currentSession();		if(curSess.user.fullName === 'default guest'){		return {error:71,errorMessage:"You must be logged!"};	}		var forum = ds.Forum.find('ID = :1',this.forum.ID);	var promoteToken;	var firstPost;		if(!curSess.belongsTo('Administrateur')){ // If we are not the dataAdmin			try{			promoteToken = curSess.promoteWith('CUD_Topic_Post');						firstPost = ds.Post.find('topic.ID == :1 and user.ID == :2 and replyTo == null',this.ID,curSess.storage.userID);						if(forum.hasAccess('modify') === true && ((firstPost.length !== 0 && firstPost.isMyPost() )|| forum.isModerator())){								this.title = title;											try{					this.save();				}catch(e){					curSess.unPromote(promoteToken);					return {error:e.sourceId,errorMessage:e.message};				}							}else{				curSess.unPromote(promoteToken);				return {error:72,errorMessage:"You don't have modify access for this forum."};			}						curSess.unPromote(promoteToken);		}catch(e){					}			}else{ // If we are the data Admin			this.title = title;				try{			this.save();		}catch(e){			return {error:e.sourceId,errorMessage:e.message};		}		}};model.Topic.entityMethods.edit.scope = 'public';